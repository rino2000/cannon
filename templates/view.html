<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Spielbrett</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      table {
        border-collapse: collapse;
      }
      td {
        width: 40px;
        height: 40px;
        text-align: center;
        border: 1px solid #000;
        font-size: 24px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Legende: Soldaten ğŸ‘‡ğŸ» Soldaten ğŸ‘†ğŸ¿ Stadt ğŸ  Stadt ğŸ¡</h1>
    <table id="board">
      {% for row in data %}
      <tr>
        {% for item in row %}
        <td>{{ item }}</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </table>

    <script>
      const socket = io();

      function renderField(field) {
        const table = document.getElementById("board");
        table.innerHTML = "";
        for (const row of field) {
          const tr = document.createElement("tr");
          for (const cell of row) {
            const td = document.createElement("td");
            td.textContent = cell;
            tr.appendChild(td);
          }
          table.appendChild(tr);
        }
      }

      socket.on("update_field", (field) => {
        renderField(field);
      });

      document.getElementById("board").addEventListener("click", (e) => {
        const td = e.target;
        const tr = td.parentNode;
        const row = Array.from(tr.parentNode.children).indexOf(tr);
        const col = Array.from(tr.children).indexOf(td);

        const data = {
          spieler: 0,
          coordinate: [[row, col]],
          town: [row, col],
        };
        socket.emit("place_soldaten", data);
      });
    </script>
  </body>
</html>
