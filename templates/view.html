<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Cannon</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      table {
        border-collapse: collapse;
      }
      td {
        border: 1px solid black;
        width: 30px;
        height: 30px;
        text-align: center;
        cursor: pointer;
      }
      #board {
        margin-top: 20px;
      }
      .info {
        margin: 10px 0;
        color: red;
      }
    </style>
  </head>
  <body>
    <h1>
      Cannon Soldaten White ğŸ‘‡ğŸ» Soldaten Black ğŸ‘†ğŸ¿ Town White ğŸ  Town Black ğŸ 
    </h1>

    <label>Room name: <input type="text" id="roomInput" /></label>
    <button id="joinBtn">Join Room</button>

    <p id="info"></p>
    <p id="playerColor"></p>
    <p id="playerPlaceSoldatenLeft"></p>
    <table id="board"></table>

    <script>
      const socket = io("http://127.0.0.1:8000", {
        transports: ["polling"],
      });

      let room = "";
      let field = [];
      let soldiers_left;
      let player = 1; // 1 = White 2 = Black
      const soldatenWhite = "ğŸ‘‡ğŸ»";
      const soldatenBlack = "ğŸ‘†ğŸ¿";
      let maxTowns = 1;
      const townWhite = "ğŸ ";
      const townBlack = "ğŸ¡";

      const boardEl = document.getElementById("board");
      const infoEl = document.getElementById("info");

      // Join Room with roomname
      document.getElementById("joinBtn").addEventListener("click", () => {
        const roomInput = document.getElementById("roomInput").value.trim();
        if (!roomInput) return alert("Enter a room name!");
        room = roomInput;
        roomInput.innerHTML = "";
        socket.emit("join_room", { room });
      });

      const letters = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k"];

      function drawField() {
        boardEl.innerHTML = "";

        // Draw grid rows
        field.forEach((row, i) => {
          const tr = document.createElement("tr");

          // Row number (0â€“9)
          const label = document.createElement("td");
          label.textContent = i;
          label.style.fontWeight = "bold";
          tr.appendChild(label);

          row.forEach((cell, j) => {
            const td = document.createElement("td");
            td.textContent = cell === 0 ? "" : cell;
            td.addEventListener("click", () => handleCellClick(i, j));
            tr.appendChild(td);
          });

          boardEl.appendChild(tr);
        });

        const footer = document.createElement("tr");
        footer.appendChild(document.createElement("td"));

        letters.forEach((letter) => {
          const td = document.createElement("td");
          td.textContent = letter;
          td.style.fontWeight = "bold";
          footer.appendChild(td);
        });

        boardEl.appendChild(footer);
      }

      function placeSoldaten(x, y) {
        socket.emit("place_soldaten", x, y, room);
      }

      function placeTown(x, y) {
        socket.emit("place_town", x, y, player, room);
      }

      function handleCellClick(x, y) {
        placeSoldaten(x, y);
        // placeTown(x, y);
      }

      socket.on("joined_room", (data) => {
        console.log(data);

        field = data.room.field;
        player = data.room.players[data.player];

        console.log(player);

        document.getElementById("playerColor").innerHTML =
          "You are player: " + (player === 1 ? "White" : "Black");
        drawField();
      });

      socket.on("info", (data) => {
        infoEl.innerHTML = data.message;
        console.log(data.message);
      });

      socket.on("update_field", (newField) => {
        field = newField;
        drawField();
      });
    </script>
  </body>
</html>
